<!--
  Copyright (c) 2023 JSONx

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  You should have received a copy of The MIT License (MIT) along with this
  program. If not, see <http://opensource.org/licenses/MIT/>.
-->
<schema
  xmlns="http://www.jsonx.org/schema-0.4.xsd"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:jxns="http://www.jsonx.org/namespace"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.jsonx.org/schema-0.4.xsd schema-0.4.xsd"
  
  jxns:jx="http://www.jsonx.org/schema-0.4.jsdx"
  targetNamespace="http://www.jsonx.org/binding-0.4.jsdx">
  
  <import namespace="http://www.jsonx.org/schema-0.4.jsdx" schemaLocation="schema-0.4.jsdx"><xi:include href="schema-0.4.jsdx"/></import>

  <string name="nonEmptyString" pattern="\S|\S.*\S"/>
  <string name="typeIdentifier" pattern="(([a-zA-Z_$][a-zA-Z\d_$]*)\.)*[a-zA-Z_$][a-zA-Z\d_$]*(\[\])?"/>
  <string name="methodIdentifier" pattern="(([a-zA-Z_$][a-zA-Z\d_$]*)\.)*[a-zA-Z_$][a-zA-Z\d_$]*(\.&lt;init&gt;)?"/>
  <string name="fieldIdentifier" pattern="[a-zA-Z_$][a-zA-Z\d_$]*"/>
  
  <object name="lang" abstract="true">
    <property name="lang" xsi:type="reference" type="nonEmptyString" nullable="false" doc="Specifies the language to which this binding applies."/>
  </object>
  
  <object name="fieldBinding" extends="lang" doc="Specifies language-specific binding.">
    <property name="field" xsi:type="reference" type="fieldIdentifier" use="optional" nullable="false" doc="Specifies the &quot;field&quot; identifier."/>
  </object>
  
  <object name="typeBinding" extends="lang" doc="Specifies language-specific binding.">
    <property name="type" xsi:type="reference" type="typeIdentifier" use="optional" nullable="false" doc="Specifies the &quot;type&quot; qualified identifier."/>
    <property name="decode" xsi:type="reference" type="methodIdentifier" use="optional" nullable="false" doc="Specifies the &quot;decode&quot; qualified function identifier that accepts input as a string, or as the native JSON type of this property, and returns an output of the specified &quot;type&quot; (or the default type if &quot;type&quot; is unspecified)."/>
    <property name="encode" xsi:type="reference" type="methodIdentifier" use="optional" nullable="false" doc="Specifies the &quot;encode&quot; qualified function identifier that accepts input of the type specified in &quot;type&quot; (or the default type if &quot;type&quot; is unspecified), and returns an output as a string, or as the native JSON type of this property."/>
  </object>
  
  <object name="typeFieldBinding" extends="typeBinding" doc="Specifies language-specific binding.">
    <!-- FIXME: Equivalent of <xs:assert test="some $path in ../@path satisfies not(@field) or count(tokenize($path, '([^\\]|\\\\)\[')) = 1 and count(tokenize($path, '([^\\]|\\\\)\.')) > 1"/> is not yet possible in JSDx -->
    <property name="field" xsi:type="reference" type="fieldIdentifier" use="optional" nullable="false" doc="Specifies the &quot;field&quot; identifier."/>
  </object>

  <object name="path" abstract="true">
    <property name="path" xsi:type="string" nullable="false"/>
  </object>
  
  <object name="fieldBindings" extends="path" abstract="true">
    <property name="bindings" xsi:type="array" nullable="false">
      <reference type="fieldBinding" nullable="false"/>
    </property>
  </object>
  
  <object name="typeFieldBindings" extends="path" abstract="true">
    <property name="bindings" xsi:type="array" nullable="false">
      <reference type="typeFieldBinding" nullable="false"/>
    </property>
  </object>
  
  <object name="any" extends="fieldBindings">
    <property name="jx:type" xsi:type="string" pattern="any" nullable="false"/>
  </object>
  
  <object name="reference" extends="fieldBindings">
    <property name="jx:type" xsi:type="string" pattern="reference" nullable="false"/>
  </object>
  
  <object name="array" extends="fieldBindings">
    <property name="jx:type" xsi:type="string" pattern="array" nullable="false"/>
  </object>
  
  <object name="object" extends="fieldBindings">
    <property name="jx:type" xsi:type="string" pattern="object" nullable="false"/>
  </object>
  
  <object name="boolean" extends="typeFieldBindings">
    <property name="jx:type" xsi:type="string" pattern="boolean" nullable="false"/>
  </object>
  
  <object name="number" extends="typeFieldBindings">
    <property name="jx:type" xsi:type="string" pattern="number" nullable="false"/>
  </object>
  
  <object name="string" extends="typeFieldBindings">
    <property name="jx:type" xsi:type="string" pattern="string" nullable="false"/>
  </object>
  
  <object name="binding">
    <property name="schema" xsi:type="reference" type="jx:schema" nullable="false"/>
    <property name="bindings" xsi:type="array" nullable="false">
      <any types="any reference array object boolean number string" nullable="false"/>
    </property>
  </object>
  
</schema>